AWSTemplateFormatVersion: "2010-09-09"
Description: RDS creation and configuration

Parameters:
    DirectusUsername:
      Type: AWS::SSM::Parameter::Value<String>
      Default: DIRECTUS_DATABASE_USERNAME
    DirectusPassword:
      Type: AWS::SSM::Parameter::Value<String>
      Default: DIRECTUS_DATABASE_PASSWORD
      NoEcho: true
    DirectusDatabaseName:
      Type: AWS::SSM::Parameter::Value<String>
      Default: DIRECTUS_DATABASE_NAME
    DirectusClient:
      Type: AWS::SSM::Parameter::Value<String>
      Default: DIRECTUS_DATABASE_CLIENT

Resources:
  RdsInstance:
    Type: AWS::RDS::DBInstance
    DeletionPolicy: Retain
    UpdateReplacePolicy: Retain
    Properties:
      DBInstanceIdentifier: !Ref DirectusDatabaseName
      BackupRetentionPeriod: 30
      DBName: !Ref DirectusDatabaseName
      Engine: !Ref DirectusClient
      MasterUsername: !Ref DirectusUsername
      MasterUserPassword: !Ref DirectusPassword
      DBInstanceClass: db.t4g.micro
      AllocatedStorage: 20
  
Outputs:
  Endpoint: 
    Value: !GetAtt RdsInstance.Endpoint.Address
  Port: 
    Value: !GetAtt RdsInstance.Endpoint.Port